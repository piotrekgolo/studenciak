{% extends 'StudenciakBundle:Page:base.html.twig' %}

{% block title %}Logowanie{% endblock %}

{% block head %}
<meta name="google-signin-scope" content="profile email">
<meta name="google-signin-client_id" content="935126113867-oe3p7844mr22v5eoo0aj6kctkej35650.apps.googleusercontent.com">
<script src="https://apis.google.com/js/platform.js" async defer></script>
<script src="//code.jquery.com/jquery-1.11.3.min.js"></script>
{% endblock %}

{% block user %}active{% endblock %}
{% block login %}active{% endblock %}

{% block view %}

<div class="g-signin2" data-onsuccess="onSignIn" data-theme="dark"></div><br /><br />

  <div id="my-signin2"></div>
  <script>
    function onSuccess(googleUser) {
      console.log('Logged in as: ' + googleUser.getBasicProfile().getName());
    }
    function onFailure(error) {
      console.log(error);
    }
    function renderButton() {
      gapi.signin2.render('my-signin2', {
        'scope': 'https://www.googleapis.com/auth/plus.login',
        'width': 200,
        'height': 50,
        'longtitle': true,
        'theme': 'dark',
        'onsuccess': onSuccess,
        'onfailure': onFailure
      });
    }
  </script>

  <script src="https://apis.google.com/js/platform.js?onload=renderButton" async defer></script>
  
<div id="zalogowano"></div>

            <div class="db-logged" style="display: none" id="div_zalogowany">
                <div class="db-logged-container">
                    <div class="db-logged-success" id="ikona"></div>
                    <header class="db-logged-gratz" id="zalogowany_dane"> </header>
                    <h3 id="zalogowany_tekst"></h3>
                    <form action="strona.htm" id="zobacz_profil" style="display: none">
                        <button type="submit">
                            <i class="icon-magnifier"></i> <span>zobacz profil</span>
                        </button>
                    </form>
                </div>
            </div>

<script>
function onSignIn(googleUser) {
    // Useful data for your client-side scripts:
    var profile = googleUser.getBasicProfile();
    //console.log("ID: " + profile.getId()); // Don't send this directly to your server!
    console.log("Name: " + profile.getName());
    console.log("Image URL: " + profile.getImageUrl());
    console.log("Email: " + profile.getEmail());

    // The ID token you need to pass to your backend:
    var id_token = googleUser.getAuthResponse().id_token;
    console.log("ID Token: " + id_token);


    $.post('{{path('Ajax_Update_MyData')}}',               
    	{name: profile.getName(), image: profile.getImageUrl(), email: profile.getEmail()}, 
    	function(response){

       $("#zalogowany_dane").html("Witaj, " + profile.getName());	//dane w naglowku

       if (response.code == "niezarejestrowany") 
       {
       	$("#zalogowany_tekst").html("Zostałeś zarejestrowany. <br /><br /> Będziesz mógł zalogować się, gdy administrator akceptuje Twoje konto.");
       	       $("#ikona").addClass("db-logged-icon-wait");
       }
       if (response.code == "niezaakceptowany")
       {
       	$("#zalogowany_tekst").html("Będziesz mógł zalogować się, gdy administrator akceptuje Twoje konto.");
       	       $("#ikona").addClass("db-logged-icon-wait");
       }
       if (response.code == "akceptowany")
       {
       	$("#zalogowany_tekst").html("zostałeś zalogowany");
       	$("#zobacz_profil").show();
       	       $("#ikona").addClass("db-logged-icon-ok");
       }



       $("#div_zalogowany").show();


   }, "json").fail(function() {alert("Cos poszlo nie tak"); });
}
</script>

   


    {% endblock %}
